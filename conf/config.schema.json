{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://github.com/yourusername/f1tenth-racetrack-generator/conf/config.schema.json",
  "title": "F1Tenth Racetrack Generator Configuration",
  "description": "Configuration schema for the F1Tenth racetrack generator tool",
  "type": "object",
  "required": ["config"],
  "additionalProperties": false,

  "definitions": {
    "distribution": {
      "oneOf": [
        {
          "type": "object",
          "properties": {
            "type": { "enum": ["uniform"] },
            "low": {
              "type": "number",
              "description": "Lower bound of uniform distribution"
            },
            "high": {
              "type": "number",
              "description": "Upper bound of uniform distribution"
            }
          },
          "required": ["type", "low", "high"],
          "additionalProperties": false
        },
        {
          "type": "object",
          "properties": {
            "type": { "enum": ["normal"] },
            "mean": {
              "type": "number",
              "description": "Mean of normal distribution"
            },
            "std": {
              "type": "number",
              "description": "Standard deviation of normal distribution"
            }
          },
          "required": ["type", "mean", "std"],
          "additionalProperties": false
        },
        {
          "type": "object",
          "properties": {
            "type": { "enum": ["halfnormal"] },
            "sigma": {
              "type": "number",
              "description": "Scale parameter of half-normal distribution"
            }
          },
          "required": ["type", "sigma"],
          "additionalProperties": false
        },
        {
          "type": "object",
          "properties": {
            "type": { "enum": ["fixed"] },
            "value": { "type": "number", "description": "Fixed value" }
          },
          "required": ["type", "value"],
          "additionalProperties": false
        }
      ]
    },

    "generator_component": {
      "type": "object",
      "properties": {
        "name": {
          "type": "string",
          "description": "Component name for debugging"
        },
        "type": {
          "type": "string",
          "enum": [
            "constant",
            "sinusoidal",
            "curvature_scaled",
            "noise",
            "random_spline"
          ],
          "description": "Type of width generator component"
        },

        "value_dist": { "$ref": "#/definitions/distribution" },
        "amplitude_dist": { "$ref": "#/definitions/distribution" },
        "frequency_dist": { "$ref": "#/definitions/distribution" },
        "phase_dist": { "$ref": "#/definitions/distribution" },
        "sensitivity_dist": { "$ref": "#/definitions/distribution" },
        "base_width_dist": { "$ref": "#/definitions/distribution" },
        "std_dev_dist": { "$ref": "#/definitions/distribution" },
        "correlation_length": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "default": 0.2
        },
        "n_control_points": {
          "type": "integer",
          "minimum": 3,
          "maximum": 20,
          "default": 8
        },
        "control_point_range": {
          "type": "object",
          "properties": {
            "min": { "type": "number", "default": 0.3 },
            "max": { "type": "number", "default": 2.0 }
          },
          "required": ["min", "max"]
        },
        "smoothness": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "default": 0.5
        }
      },

      "required": ["type"],
      "allOf": [
        {
          "if": {
            "properties": { "type": { "const": "constant" } }
          },
          "then": {
            "properties": {
              "value_dist": { "$ref": "#/definitions/distribution" }
            },
            "required": ["value_dist"]
          }
        },
        {
          "if": {
            "properties": { "type": { "const": "sinusoidal" } }
          },
          "then": {
            "properties": {
              "amplitude_dist": { "$ref": "#/definitions/distribution" },
              "frequency_dist": { "$ref": "#/definitions/distribution" },
              "phase_dist": {
                "$ref": "#/definitions/distribution",
                "description": "Phase in radians"
              }
            },
            "required": ["amplitude_dist", "frequency_dist", "phase_dist"]
          }
        },
        {
          "if": {
            "properties": { "type": { "const": "curvature_scaled" } }
          },
          "then": {
            "properties": {
              "sensitivity_dist": { "$ref": "#/definitions/distribution" },
              "base_width_dist": { "$ref": "#/definitions/distribution" }
            },
            "required": ["sensitivity_dist"]
          }
        },
        {
          "if": {
            "properties": { "type": { "const": "noise" } }
          },
          "then": {
            "properties": {
              "std_dev_dist": { "$ref": "#/definitions/distribution" },
              "correlation_length": {
                "type": "number",
                "minimum": 0,
                "maximum": 1,
                "default": 0.2,
                "description": "Correlation length in normalized t space [0,1]"
              }
            },
            "required": ["std_dev_dist"]
          }
        },
        {
          "if": {
            "properties": { "type": { "const": "random_spline" } }
          },
          "then": {
            "properties": {
              "n_control_points": {
                "type": "integer",
                "minimum": 3,
                "maximum": 20,
                "default": 8,
                "description": "Number of control points for spline"
              },
              "control_point_range": {
                "type": "object",
                "properties": {
                  "min": { "type": "number", "default": 0.3 },
                  "max": { "type": "number", "default": 2.0 }
                },
                "required": ["min", "max"]
              },
              "smoothness": {
                "type": "number",
                "minimum": 0,
                "maximum": 1,
                "default": 0.5,
                "description": "Spline smoothing factor"
              }
            },
            "required": ["n_control_points", "control_point_range"]
          }
        }
      ],
      "additionalProperties": false
    }
  },

  "properties": {
    "config": {
      "type": "object",
      "description": "Main configuration object",
      "additionalProperties": false,

      "properties": {
        "space": {
          "type": "object",
          "description": "Physical space parameters",
          "additionalProperties": false,
          "properties": {
            "width": {
              "type": "number",
              "minimum": 5,
              "maximum": 100,
              "default": 20.0,
              "description": "Width of the rectangular space (meters)"
            },
            "height": {
              "type": "number",
              "minimum": 5,
              "maximum": 100,
              "default": 10.0,
              "description": "Height of the rectangular space (meters)"
            }
          },
          "required": ["width", "height"]
        },

        "centerline": {
          "type": "object",
          "description": "Centerline generation parameters",
          "additionalProperties": false,
          "properties": {
            "n_points": {
              "type": "integer",
              "minimum": 20,
              "maximum": 500,
              "default": 60,
              "description": "Number of initial random points for Voronoi generation"
            },
            "max_lloyd_iterations": {
              "type": "integer",
              "minimum": 0,
              "maximum": 100,
              "default": 10,
              "description": "Number of Lloyd's algorithm iterations"
            },
            "max_verifying_iterations": {
              "type": "integer",
              "minimum": 1,
              "maximum": 1000,
              "default": 50,
              "description": "Maximum attempts to generate valid centerline"
            },
            "virtual_grid_width": {
              "type": "number",
              "minimum": 1,
              "maximum": 20,
              "default": 5.0,
              "description": "Cell size for virtual grid region selection (meters)"
            },
            "virtual_grid_coverage": {
              "type": "number",
              "minimum": 0.1,
              "maximum": 1.0,
              "default": 0.8,
              "description": "Fraction of grid cells to sample from"
            },
            "curvature_threshold": {
              "type": "number",
              "minimum": 0.05,
              "maximum": 1.0,
              "default": 0.3,
              "description": "Maximum allowed curvature (1/meters)"
            }
          },
          "required": [
            "n_points",
            "max_lloyd_iterations",
            "curvature_threshold"
          ]
        },

        "walls": {
          "type": "object",
          "description": "Wall (duct) generation parameters",
          "additionalProperties": false,
          "properties": {
            "duct_thickness": {
              "type": "number",
              "minimum": 0.05,
              "maximum": 0.5,
              "default": 0.3,
              "description": "Physical thickness of each duct (meters)"
            },
            "min_duct_length": {
              "type": "number",
              "minimum": 0.2,
              "maximum": 2.0,
              "default": 0.5,
              "description": "Minimum length of a duct segment (meters)"
            },
            "max_duct_length": {
              "type": "number",
              "minimum": 0.5,
              "maximum": 5.0,
              "default": 2.0,
              "description": "Maximum length of a duct segment (meters)"
            },
            "min_track_width": {
              "type": "number",
              "minimum": 1.0,
              "maximum": 10.0,
              "default": 3.0,
              "description": "Minimum allowed track width (meters)"
            },
            "wall_points_per_meter": {
              "type": "integer",
              "minimum": 10,
              "maximum": 200,
              "default": 50,
              "description": "Density of generated wall points (points per meter along wall)"
            },
            "connection_tolerance": {
              "type": "number",
              "minimum": 0.01,
              "maximum": 0.5,
              "default": 0.15,
              "description": "Tolerance for connecting duct segments (meters)"
            },
            "resolution": {
              "type": "number",
              "minimum": 0.01,
              "maximum": 0.2,
              "default": 0.05,
              "description": "Occupancy grid cell size (meters)"
            },
            "left_right_correlation": {
              "type": "number",
              "minimum": -1,
              "maximum": 1,
              "default": 0.8,
              "description": "Correlation between left and right wall widths (-1 to 1)"
            },
            "width_model": {
              "type": "object",
              "description": "Generative model for track width profile",
              "additionalProperties": false,
              "properties": {
                "components": {
                  "type": "array",
                  "description": "List of generator components to combine",
                  "items": { "$ref": "#/definitions/generator_component" },
                  "minItems": 1
                },
                "clipping": {
                  "type": "string",
                  "enum": ["max", "min", "none"],
                  "default": "max",
                  "description": "How to handle exceeding maximum width: clip to max, use min, or allow (unsafe)"
                }
              },
              "required": ["components"]
            }
          },
          "required": ["duct_thickness", "min_track_width", "width_model"]
        },

        "output": {
          "type": "object",
          "description": "Output and debugging parameters",
          "additionalProperties": false,
          "properties": {
            "output_dir": {
              "type": "string",
              "default": "output",
              "description": "Directory for saving output files"
            },
            "visualize": {
              "type": "boolean",
              "default": false,
              "description": "Enable debug visualizations"
            },
            "debug_output_dir": {
              "type": "string",
              "default": "debug",
              "description": "Directory for debug images"
            },
            "random_seed": {
              "type": ["integer", "null"],
              "minimum": 0,
              "maximum": 4294967295,
              "default": null,
              "description": "Random seed for reproducibility (null = random)"
            }
          },
          "required": ["visualize"]
        }
      },
      "required": ["space", "centerline", "walls", "output"]
    }
  }
}
